---
title: "Consolidate Models from Different Sources"
sidebar: rdp_sidebar
permalink: api_create_data_model_scenario50.html
folder: rdp
type: HowToAPI
---

{% include snippets/api_preview.md %}

Riversand Platform accepts models from different sources. These models are updated periodically and the system must be able to accept the updates.

Riversand Platform must form a consolidated model, incorporating changes from multiple sources. Since there can be more than one source augmenting a given model, the system defines a precedence hierarchy to merge attributes and relationships from multiple sources. 

## Scenario

Consolidate models from three input sources - platformseed, tenantseed and tenant, wherein the precedence from highest to lowest is **tenant>>tenantSeed>>platformseed**. 

{% picture ModelSource.png alt="Consolidating Models from different sources" %}

### Pre-requisites

* To enable consolidation of models, "isModelSourceEnabled" must be set to true in the tenant configuration. 
* The list of all sources must be included in the tenant configuration in the correct order(based on precedence).
<pre><code>
  "configObjects": [
  {
      ...
      ...
      ...

      "isModelSourceEnabled": true,
      "sources": [
          {
              "id": "platformSeed",
              "name": "Platform Seed",
              "description": "Configuration defined by the platform",
              "contact": "Riversand",
              "url": "https://www.riversand.com/"
          },
          {
              "id": "tenantSeed",
              "name": "brightstar Configuration",
              "description": "Configuration defined by brightstar"
          }
      ],
      ...
      ...
      ...
  }
  ]
</code></pre>
* Model changes made by the UI or services which are tenant specific will have "source": "tenant". Source tenant is a special case that represents an override of other source models. The UI specifies source tenant, when sending model updates. 

{% include callout.html content="**Notes :** 
* When **isModelSourceEnabled** is set to true in the tenant configuration, all the create/update/delete datamodel APIs must have an additional parameter called **source** defined.
* The consolidated model is generated when any of the source models which it depends on is updated. When a model is updated, the model manager looks at the source to know which source model to update. The consolidated model is then generated by merging all sources. Thus, when the user queries the consolidated model, it already exists and is not generated at the time of get. 
* When a source model is deleted, the consolidated model is regenerated using the remaining source models. When all source models are deleted, the consolidated model is deleted.
* Individual items in the consolidated model like contexts, attributes, relationships and properties need to identify their source. This is done using property **source**.
* The source identifier is maintained at the model level, similar to domain. Reference entity source is expressed at the attribute value level. 
* The consolidated model is a read-only model. It is an error to update/delete the consolidated model.
" type="primary" %}

{% include snippets/header.html %}

## Request

In the [entity model](api_manage_model.html) object, 
* Specify the id and name as "sku_entityManageModel", as you are creating manage model for entity type "sku".
* Specify the source. This is the name of the source that is invoking the API. In this scenario, it can be "tenantSeed", "platformSeed" or "tenant". 
* In this scenario, we are showing the consolidation of sku_entityManageModel from different sources. Similarly, other models such as defaultModel, displayModel etc are also consolidated. 

### Create sku_entityManageModel with source as "tenantSeed"

<pre><code>
POST **{{site.data.rdp_glossary.createdatamodel}}**
Headers: Content-Type: application/json
Body:
{
  "clientId": "someguid",
  "clientState": {
    "someJson": {}
  },
  {
    "entityModel": {
      <span style="background-color: #FFFF00">"id": "sku_entityManageModel",</span>
      <span style="background-color: #FFFF00">"name": "sku_entityManageModel",</span>
      <span style="background-color: #FFFF00">"type": "entityManageModel",</span>
      "domain": "generic",
      <span style="background-color: #FFFF00">"source": "tenantSeed",</span>
      "data": {
        "attributes": {
          "piesmaintenancetype": {
            "properties": {
              "externalName": "Maintenance Type",
              "groupName": "Price Sheet",
              "dataType": "string",
              "isReferenceType": true,
              "referenceEntityInfo": [
                {
                  "refRelationshipName": "hasReferenceTo",
                  "refEntityType": "piesmaintenancetype"
                }
              ]
            }
          },
          "pricesheetnumber": {
            "properties": {
              "externalName": "pricesheetnumber",
              "isEntityIdentifier": true,
              "dataType": "string"
            }
          }
        }
      }
    }
  }
}
</code></pre> 

### Create sku_entityManageModel with source as "PlatformSeed"

<pre><code>
POST **{{site.data.rdp_glossary.createdatamodel}}**
Headers: Content-Type: application/json
Body:
{
  "clientId": "someguid",
  "clientState": {
    "someJson": {}
  },
  {
    "entityModel": {
      <span style="background-color: #FFFF00">"id": "sku_entityManageModel",</span>
      <span style="background-color: #FFFF00">"name": "sku_entityManageModel",</span>
      <span style="background-color: #FFFF00">"type": "entityManageModel",</span>
      "domain": "generic",
      <span style="background-color: #FFFF00">"source": "platformSeed",</span>
      "data": {
        "attributes": {
          "piescurrencycode": {
            "properties": {
              "externalName": "Currency Code",
              "groupName": "Price Sheet",
              "dataType": "string",
              "isReferenceType": true,
              "referenceEntityInfo": [
                {
                  "refRelationshipName": "hasReferenceTo",
                  "refEntityType": "piescurrencycode"
                }
              ]
            }
          },
          "piespricezone": {
            "properties": {
              "externalName": "Price Zone",
              "groupName": "Price Sheet",
              "dataType": "string"
            }
          }
        }
      }
    }
  }
}
</code></pre> 

### Create sku_entityManageModel with source as "tenant"(override)

<pre><code>
POST **{{site.data.rdp_glossary.createdatamodel}}**
Headers: Content-Type: application/json
Body:
{
  "clientId": "someguid",
  "clientState": {
    "someJson": {}
  },
  {
    "entityModel": {
      <span style="background-color: #FFFF00">"id": "sku_entityManageModel",</span>
      <span style="background-color: #FFFF00">"name": "sku_entityManageModel",</span>
      <span style="background-color: #FFFF00">"type": "entityManageModel",</span>
      "domain": "generic",
      <span style="background-color: #FFFF00">"source": "tenant",</span>
      "data": {
        "attributes": {
          "pricesheetnumber": {
            "properties": {
              "externalName": "pricesheetnumber_tenant",
              "isEntityIdentifier": true,
              "dataType": "string"
            }
          },
          "piespricevalue": {
            "properties": {
              "externalName": "Price Value",
              "groupName": "Price Value",
              "dataType": "string"
            }
          }
        }
      }
    }
  }
}
</code></pre> 

### Update sku_entityManageModel with source as "tenantSeed"

<pre><code>
POST **{{site.data.rdp_glossary.updatedatamodel}}**
Headers: Content-Type: application/json
Body:
{
  "clientId": "someguid",
  "clientState": {
    "someJson": {}
  },
  {
    "entityModel": {
      <span style="background-color: #FFFF00">"id": "sku_entityManageModel",</span>
      <span style="background-color: #FFFF00">"name": "sku_entityManageModel",</span>
      <span style="background-color: #FFFF00">"type": "entityManageModel",</span>
      "domain": "generic",
      <span style="background-color: #FFFF00">"source": "tenantSeed",</span>
      "data": {
        "attributes": {
          "pricesheetnumber": {
            "properties": {
              "externalName": "pricesheetnumber_tenantseed_update",
              "isEntityIdentifier": true,
              "dataType": "string"
            }
          }
        }
      }
    }
  }
}
</code></pre> 

### Verification - Get All Models

<pre><code>
POST **{{site.data.rdp_glossary.getdatamodel}}**
Headers: Content-Type: application/json
Body:
{
  "clientId": "someguid",
  "clientState": {
    "someJson": {}
  },
  "params": {
    "query": {
      "filters": {
        "typesCriterion": [
          <span style="background-color: #FFFF00">"entityManageModel"</span>
        ]
      }
    },
    "fields": {
      "attributes": [
        "_ALL"
      ],
      "relationships": [
        "_ALL"
      ]
    }
  }
}
</code></pre> 

## Response

As you can see in the response, the different source models are internally available with suffix "_source". The consolidated model merges all the attributes, taking precedence hierarchy into consideration. Although attribute "pricesheetnumber" is updated by "tenantSeed", the consolidated model uses the "pricesheetnumber" of source "tenant". This is because "tenant" source has precedence over "tenantSeed".

{% include callout.html content="**Note**: The consolidated model is assigned source **internal**. Only the consolidated model is exposed to the user. Other models are internal to Riversand Platform.
" type="primary" %}

<pre><code>
{
  "request": {
    "returnRequest": false,
    "params": {},
    "requestId": "e25b1b0d-f57f-49cb-922f-84e23d42746f"
  },
  "response": {
    "entityModels": [
      {
        "id": "sku_entityManageModel_tenantSeed",
        "name": "sku_entityManageModel_tenantSeed",
        "type": "entityManageModel",
        "domain": "generic",
        "source": "tenantSeed",
        "properties": {
          "createdService": "entityManageModelService",
          "createdBy": "admin.infodev@riversand.com",
          "createdDate": "2018-09-05T23:34:12.830-0500",
          "modifiedService": "entityManageModelService",
          "modifiedBy": "admin.infodev@riversand.com",
          "modifiedDate": "2018-09-06T01:02:52.282-0500"
        },
        "data": {
          "attributes": {
            "piesmaintenancetype": {
              "properties": {
                "externalName": "Maintenance Type",
                "groupName": "Price Sheet",
                "dataType": "string",
                "isReferenceType": true,
                "referenceEntityInfo": [
                  {
                    "refRelationshipName": "hasReferenceTo",
                    "refEntityType": "piesmaintenancetype"
                  }
                ]
              }
            },
            "pricesheetnumber": {
              "properties": {
                "externalName": "pricesheetnumber_tenantseed_update",
                "isEntityIdentifier": true,
                "dataType": "string"
              }
            }
          }
        }
      },
      {
        "id": "sku_entityManageModel",
        "name": "sku_entityManageModel",
        "type": "entityManageModel",
        "domain": "generic",
        "source": "internal",
        "properties": {
          "createdService": "entityManageModelService",
          "createdBy": "admin.infodev@riversand.com",
          "modifiedService": "entityManageModelService",
          "modifiedBy": "admin.infodev@riversand.com",
          "createdDate": "2018-09-06T01:00:00.420-0500",
          "modifiedDate": "2018-09-06T01:00:00.420-0500",
          "source": "tenant"
        },
        "data": {
          "attributes": {
            "piescurrencycode": {
              "properties": {
                "externalName": "Currency Code",
                "groupName": "Price Sheet",
                "dataType": "string",
                "isReferenceType": true,
                "referenceEntityInfo": [
                  {
                    "refRelationshipName": "hasReferenceTo",
                    "refEntityType": "piescurrencycode"
                  }
                ],
                "source": "platformSeed"
              }
            },
            "piespricezone": {
              "properties": {
                "externalName": "Price Zone",
                "groupName": "Price Sheet",
                "dataType": "string",
                "source": "platformSeed"
              }
            },
            "piesmaintenancetype": {
              "properties": {
                "externalName": "Maintenance Type",
                "groupName": "Price Sheet",
                "dataType": "string",
                "isReferenceType": true,
                "referenceEntityInfo": [
                  {
                    "refRelationshipName": "hasReferenceTo",
                    "refEntityType": "piesmaintenancetype"
                  }
                ],
                "source": "tenantSeed"
              }
            },
            "pricesheetnumber": {
              "properties": {
                "externalName": "pricesheetnumber_tenant",
                "isEntityIdentifier": true,
                "dataType": "string",
                "source": "tenant"
              }
            },
            "piespricevalue": {
              "properties": {
                "externalName": "Price Value",
                "groupName": "Price Value",
                "dataType": "string",
                "source": "tenant"
              }
            }
          }
        }
      },
      {
        "id": "sku_entityManageModel_platformSeed",
        "name": "sku_entityManageModel_platformSeed",
        "type": "entityManageModel",
        "domain": "generic",
        "source": "platformSeed",
        "properties": {
          "createdService": "entityManageModelService",
          "createdBy": "admin.infodev@riversand.com",
          "modifiedService": "entityManageModelService",
          "modifiedBy": "admin.infodev@riversand.com",
          "createdDate": "2018-09-05T23:34:23.511-0500",
          "modifiedDate": "2018-09-05T23:34:23.511-0500"
        },
        "data": {
          "attributes": {
            "piescurrencycode": {
              "properties": {
                "externalName": "Currency Code",
                "groupName": "Price Sheet",
                "dataType": "string",
                "isReferenceType": true,
                "referenceEntityInfo": [
                  {
                    "refRelationshipName": "hasReferenceTo",
                    "refEntityType": "piescurrencycode"
                  }
                ]
              }
            },
            "piespricezone": {
              "properties": {
                "externalName": "Price Zone",
                "groupName": "Price Sheet",
                "dataType": "string"
              }
            }
          }
        }
      },
      {
        "id": "sku_entityManageModel_tenant",
        "name": "sku_entityManageModel_tenant",
        "type": "entityManageModel",
        "domain": "generic",
        "source": "tenant",
        "properties": {
          "createdService": "entityManageModelService",
          "createdBy": "admin.infodev@riversand.com",
          "modifiedService": "entityManageModelService",
          "modifiedBy": "admin.infodev@riversand.com",
          "createdDate": "2018-09-06T01:00:00.420-0500",
          "modifiedDate": "2018-09-06T01:00:00.420-0500"
        },
        "data": {
          "attributes": {
            "pricesheetnumber": {
              "properties": {
                "externalName": "pricesheetnumber_tenant",
                "isEntityIdentifier": true,
                "dataType": "string"
              }
            },
            "piespricevalue": {
              "properties": {
                "externalName": "Price Value",
                "groupName": "Price Value",
                "dataType": "string"
              }
            }
          }
        }
      }
    ],
    "status": "success",
    "totalRecords": 4
  }
}
</code></pre> 

## Troubleshooting

See [Troubleshooting Tips](api_troubleshooting_tips.html), for common troubleshooting tips, if required.